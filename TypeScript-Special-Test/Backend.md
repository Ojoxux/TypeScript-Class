# 発表タイトル
TypeScript 関数型バックエンド開発のリアル

## 概要
これは、TypeScriptを使って飲食店向けSaaSのバックエンドを関数型っぽいスタイルで開発したという発表です。
結論としては、ドメインレイヤー以外はそれほど変わらないということ。システム全体の設計としては、これまで通りのオニオンアーキテクチャを採用しているそうです 。関数型スタイルを主に適用しているのはドメイン層で 、その目的は関数型プログラミング自体ではなく、型や静的検査をより積極的に活用して堅牢なシステムを作ることにあるそうです 。
ドメインレイヤーでの関数型スタイルとは、主に以下の3点とのことでした 。
- ドメインオブジェクトの構造を型（interface）で表現する 。
- オブジェクトの変更を、関数適用による状態遷移としてイミュータブルに表現する 。
- 失敗の分岐（エラー）をResult型で表現する 。
ユースケースは、Result型を返す関数を合成して処理フローを作る「ワークフロー」として実装しているそうです 。IO（DBアクセスなど）はRepositoryパターンなど従来通りの作りで、ドメイン層とはIO分離を丁寧に行うのがポイントだそうです 。

## 印象に残ったこと
- 伊藤さんと言えばの「Domain Modeling Made Functional」という本からインスピレーションを受けているのが面白かった 。

- 関数型にするのが目的ではなく、型や静的検査を最大限に使ってバグを減らしたいという目的がはっきりしていたのが、すごく共感できた。

- ドメインオブジェクトの変更を、オブジェクトの内部状態を書き換えるのではなく、関数を適用して新しい状態のオブジェクトを得るという考え方が、新鮮で分かりやすかった 。

- Result型を使ったエラーハンドリングと、それを.andThen()などでつなげて一本道にするスタイル（Railway Oriented Programming）は、コードの見通しが良くなりそうでいいと思った。エラー処理漏れがなくなるっていうのは、業務システムではめちゃくちゃ重要そう 。

- 実際に2年ほど運用して、不具合による障害が少なく、堅牢になったという結果が出ているのが、このスタイルの効果を物語っていてすごい。特に、NullPointerException的なバグがほとんどなくなったというのは、めちゃくちゃ魅力的です 。

- 型で保証できる部分が増えたことで、ユニットテストが減ったというのも驚き。

## 今後の実装で真似したいこと
> フロントエンド開発で真似したいと思ったポイント

- UIの状態やAPIデータを型で厳密に表現すること。

- UI状態の更新を、関数を適用した結果として新しい状態を得る（Immutable）スタイルで書くこと。

- API呼び出しやバリデーションの結果をResult型で扱うこと。

- API連携やDOM操作みたいな副作用（IO）と、純粋な状態更新ロジックをちゃんと分けること

## その他
- Result型パズルはちょっと大変そうに見えたが、堅牢になるなら頑張る価値はありそう。ただ、どこまで関数型を取り入れるかは、プロジェクトのメンバーや特性を考えて決めるべきという話は、現実的で大事な視点だなと思った。

- ワークフローの型定義が少し冗長という話もありましたが、ユーティリティ型でどう簡素化できるのか、具体例を見てみたい。

- データと振る舞いを分離することで、DTOを介した値の詰め替えが不要になるという話は、思わぬメリットで面白いなと思った。分割代入が効いてるんだな。