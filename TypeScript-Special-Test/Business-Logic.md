# タイトル
fast-checkとnever-throwの PBT+Result型で堅牢なビジネスロジックを実現する

## 概要
TypeScriptを使って、バックエンドで堅牢なビジネスロジックを作るための方法と、それを効率的にテストする方法についての発表です。ビジネスロジックを表現するのに「Result型」という考え方（Typescriptの判別共用体とかで実現できる） や、それを助けてくれる「Neverthrow」というライブラリが紹介されていて、テストには「プロパティベーステスト（PBT）」という新しいやり方と、そのための「fast-check」というライブラリが紹介されていました。これらの技術を組み合わせることで、型を使ってエラーをしっかり表現したり、テストをもっと広くできるようになるというのがテーマです。

## 印象に残ったこと
- 例外によるエラー処理の問題点が、すごく分かりやすかった。呼び出し元でエラーの種類が分からないとか、try-catchを書かないとエラー処理されないとか、複数のエラーをまとめて扱うのが大変という具体的な例を見て納得した。

- Result型の考え方がいい。成功か失敗かを型でしっかり表現するというのが、TypeScriptの良さを活かしている感じがした。Result<T, E>って書くだけで、返ってくる結果に成功の値（T）とエラーの情報（E）があるって分かるのが良い。

- Neverthrowを使うと、Result型を返す関数の処理をメソッドチェーンで繋げて書ける(mapとかandThen)のが、ごちゃごちゃしたif文がなくなってスッキリしそうで良かった。あと、複数のエラーを配列にまとめてくれる機能も便利そう。

- eslint-plugin-neverthrowを使うと、Result型を返してる関数の結果をちゃんと処理しないとlintでエラーになるという点。エラー処理を強制できるというのは、バグを減らす上でめちゃくちゃ強力だと思った。

- プロパティベーステストの「こういう性質を満たす入力なら、結果はこうなるはず」 一番シンプルな失敗する入力値を見つけてくれる（Shrink） っていう機能が便利すぎる。

- Result型とPBTを組み合わせることで、エラーが型で分かりやすくなるのと、色々な入力パターンでテストできるのが合わさって、コードを書いている途中で高速にバグが見つけられるっていう話は、開発の効率を上げる上でもすごく魅力的だと思いました。

## 今後に活かしたいこと
- まずは、簡単なところからで良いので、自分でコードを書くときに「Result型」を使ってみて、エラーを型で表現する練習をしたい。

- Result型を使うとき、Neverthrowを入れてみて、mapやandThenを使った書き方を試してみたい。メソッドチェーンを使いこなしたい。

- そして、eslint-plugin-neverthrowも入れて、エラー処理を忘れないように強制的にしたい。

- テストについて、これまでのユニットテストだけでなく、PBTにも挑戦してみたい。特に、色々な入力がありうるような処理（ex. 何かを計算する関数、文字列をパースする処理）で、fast-checkを使ってプロパティを定義してテストを書いてみたい。

## 感想
- Result型やPBTという考え方そのものが面白かったのはもちろんだが、実際に業務で使ってみてどうだったかという話や、導入する上での大変さ（学習コスト、既存ライブラリとの兼ね合いなど） についても包み隠さず話してくれたのが、とても参考になった。

- Result型のメソッドチェーンは慣れるまでは少しコードが追いづらくなりそうと感じたのと、PBTの「テストオラクル問題」（ランダムな入力に対して、どういう結果が正しいかをどうやってテストコードに書くか）が、実際にやるとなったら難しそうだと思った。

- AIコーディングエージェントとの相性が悪い可能性があるという話も、今どきならではの視点で興味深かった。